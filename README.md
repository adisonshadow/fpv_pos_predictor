# FPV 拦截预测算法

----------
应对FPV这种**高度机动**的目标的**非线性**轨迹预测，使用**无损卡尔曼滤波 (Unscented Kalman Filter, UKF)** 算法和 **恒定转弯率和速度 (Constant Turn Rate and Velocity, CTRV)** 模型，来捕捉到FPV直线飞行和转弯两种关键运动状态。

## 运动状态和模型定义

**状态向量 $\mathbf{x}$：**
$$\mathbf{x} = [x, y, v, \phi, \dot{\phi}]^T$$
其中：

  * $x, y$：空间位置 (平面)
  * $v$：速度
  * $\phi$：航向角 (Heading)
  * $\dot{\phi}$：转弯率 (Turn Rate)

**非线性状态转移函数 $\mathbf{f}(\mathbf{x}, \Delta t)$：**
这是 UKF 的核心，用于预测下一时刻的状态。

## 结果解读和射击建议

### 1\. 预测位置及准确率 (Accuracy Score)

  * **预测位置:** `predicted_position` 是 UKF 根据当前估计状态和 CTRV 模型推算出来的 $50\text{ms}$ / $200\text{ms}$ / $500\text{ms}$ / $1\text{s}$ 后的 $(x, y)$ 坐标。
  * **准确率 (Accuracy Score):**
      * 这是一个**0 到 1**的浮点数，**越接近 1 越准确**。
      * 它基于预测位置的协方差矩阵 $\mathbf{P}$（$\mathbf{P}_{xy}$）。$\mathbf{P}$ 越大，说明预测的**不确定性**越高，因此准确率得分越低。
      * **$50\text{ms}$** 的预测通常会比 **$1\text{s}$** 的预测准确率高得多，因为不确定性会随时间累积。
      * **工程意义：** 这个值可以用来调整激光器的**瞄准区域大小**（协方差大的时候，可以扩大射击范围）。

### 2\. 射击建议 (Fire Feasibility)

  * **核心逻辑:** FPV运动越复杂、越剧烈，其轨迹越难以预测，因此越不适合射击。
  * **计算方式:** 结合了**速度 $v$** 和**转弯率 $\dot{\phi}$** 两个关键指标。
  * **$0 \sim 1$ 浮点数:**
      * **接近 1.0 (例如 $>0.8$):** FPV运动平稳（低速、直线），预测精度高，**适合射击**。
      * **接近 0.0 (例如 $<0.3$):** FPV正在高速或剧烈转弯（机动），预测精度低，**不适合射击**。

## TODO

1.  **3D 状态:** FPV是三维运动。为了更精确，状态向量 $\mathbf{x}$ 应该扩展到 $\mathbf{x} = [x, y, z, v_x, v_y, v_z, a_x, a_y, a_z]^T$ 或使用 3D 的 CTRV 模型。
2.  **多模型 (IMM):** UKF 虽然强大，但仍是单一模型。**交互式多模型 (IMM)** 算法是跟踪高度机动目标的黄金标准，它能实时判断FPV是在直线加速、匀速转弯，还是在静止悬停，并加权融合所有模型的预测结果，以获得更高的准确率。
3.  **实际参数调优:** 代码中的 `measurement_std` (传感器噪声) 和 `process_std` (模型噪声) 必须根据实际的视觉识别系统（摄像头、相控阵雷达）的性能进行反复测试和调优。
